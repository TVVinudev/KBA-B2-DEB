<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DLIBRA | Add Book</title>
    <script src="https://cdn.tailwindcss.com"></script>

    <script>
        window.onload = async () => {
            try {
                const response = await fetch("http://127.0.0.1:8000/viewUser", {
                    method: "GET",
                    credentials: "include"
                })

                const data = await response.json();

                console.log(data.user)

                if (data.user) {
                    document.getElementById('signin').style.display = 'none';
                    document.getElementById('logout').style.display = 'block';
                }
                if (data.user == 'admin') {
                    document.getElementById('addBook').style.display = 'block';
                }

            } catch (error) {
                console.error(error);
            }
        }


        async function addBook() {

            const bookId = document.getElementById('bookId').value;
            const bookName = document.getElementById('bookname').value;
            const author = document.getElementById('author').value;
            const image = document.getElementById('image').value;
            const description = document.getElementById('description').value;

            console.log("Book ID: ", bookId);
            console.log("Book Name: ", bookName);
            console.log("Author: ", author);
            console.log("Description: ", description);
            console.log("image: ", image);


            if (!bookId || !bookName || !author || !description) {
                alert("Please fill in all fields.");
            } 

            const response = await fetch("http://127.0.0.1:8000/addBook", {
                method: "POST",
                credentials: "include",
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    bookId: bookId,
                    bookname: bookName,
                    author: author,
                    description: description,
                    image: image
                })
            })

            console.log(response);

            if(response.ok){
                alert('book add successfully')
            }else{
                alert('book cannot uploaded')
            }
        }


        async function logout() {
            try {
                const response = await fetch('http://127.0.0.1:8000/logout', {
                    method: "GET",
                    credentials: "include"
                })
                console.log(response.status);
                if (response.ok) {
                    alert('Logout successfully');
                    window.location.href = './pages/signin.html'
                } else {
                    alert('you are not login');
                    window.location.href = './pages/signin.html'
                }
            } catch (error) {
                console.error(error);

            }

        }


    </script>


</head>

<body>
    <div class="m-3 p-4  flex justify-between shadow-2xl bg-[white] top-0 sticky">
        <img src="./images/kbalogo.png" alt="" class="p-2 w-12">
        <nav>
            <ul class="flex justify-end p-2">
                <li class="pr-5"><a href="../index.html"
                        class="text-[#16423C] hover:text-gray-400 font-[200] hover:font-[700]">HOME</a></li>
                <li class="pr-5"><a href="./add_books.html"
                        class="text-[#16423C] hover:text-gray-400 font-[200] hover:font-[700]" style="display:none;"
                        id="addBook">ADD BOOK</a></li>
                <li class="pr-5"><a href="./view_books.html"
                        class="text-[#16423C] hover:text-gray-400 font-[200] hover:font-[700]">VIEW BOOK</i>
                <li class="pr-5"><a href="./signup.html"
                        class="text-[#16423C] hover:text-gray-400 font-[200] hover:font-[700]" style="display:block;"
                        id="signin">SIGN IN</a></li>
                <li class="pr-5"><button class="text-[#16423C] hover:text-gray-400 font-[200] hover:font-[700]"
                        style="display:none;" id="logout" onclick="logout()">LOGOUT</button></li>
            </ul>
        </nav>
    </div>

    <!------------------Navbar------------------------>

    <div class="w-full h-[90vh] bg-[#16423C] flex justify-center ">
        <div class=" h-[700px] w-[600px] bg-[#C4DAD2] mt-14 rounded-2xl shadow-2xl">
            <div class="block text-center pt-9 text-3xl text-white">
                <span class="font-bold "> ADD BOOK</span>
            </div>
            <div class="block text-center mt-5">
                <input type="text" class="w-[450px] h-14 rounded-2xl pl-5" placeholder="Book ID" id="bookId">
            </div>
            <div class="block text-center mt-5">
                <input type="text" class="w-[450px] h-14 rounded-2xl pl-5" placeholder="Book Name" id="bookname">
            </div>
            <div class="block text-center mt-5">
                <input type="text" class="w-[450px] h-14 rounded-2xl pl-5" placeholder="Author Name" id="author">
            </div>
            <div class="block text-center mt-5">
                <input type="file" class="w-[450px] h-14 rounded-2xl pl-5" placeholder="Author Name" id="image">
            </div>

            <div class="block text-center mt-5">
                <textarea name="" class="w-[450px] h-[150px] rounded-2xl pl-5 pt-5" placeholder="Description.........."
                    id="description"></textarea>
            </div>
            <div class="block text-center mt-5">
                <button class="rounded-2xl bg-[#16423C] px-48 py-2 text-white" onclick="addBook()">SUBMIT</button>
            </div>

        </div>
    </div>
    <!--------------------- section  ------------------------------>



    <div class="flex justify-between mx-5">
        <span> dlribrary@gmial.com</span>
        <span>123 street,Kakkanad,Ernakulam</span>
        <span>+123-456-7890</span>
        <span class="font-bold">DLIBRA</span>
    </div>

    <!------------------ Footer --------------------------->

</body>

</html>